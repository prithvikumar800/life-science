(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{8971:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/Employee",function(){return r(349)}])},349:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(4848),l=r(6540),s=r(8869),o=r(6665),i=r(3093);r(4338);var n=r(9196);let c=e=>{let{userData:t,loading:r}=e,[c,d]=(0,l.useState)([{titleName:"",subtitleName:"",result:"",theoretical:""}]),[u,x]=(0,l.useState)({certificateCategory:"None",certificateTitle:"",materialCode:"",lotno:"",mfgDate:"",expiryDate:"",customCategory:""}),[m,p]=(0,l.useState)((null==t?void 0:t.name)||""),[h,b]=(0,l.useState)((null==t?void 0:t.mobile)||""),[f,g]=(0,l.useState)(null),[y,N]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[k,D]=(0,l.useState)(!1),[S,R]=(0,l.useState)(null),[E,T]=(0,l.useState)(null),z=e=>{d(c.filter((t,r)=>r!==e))},I=(e,t,r)=>{d(c.map((a,l)=>l===e?{...a,[t]:r}:a))},F=(e,t)=>{if(x(r=>({...r,[e]:t,..."certificateCategory"===e&&"None"!==t?{customCategory:""}:{}})),"certificateCategory"===e){var r;console.log("Selected Category:",t),console.log("Fetched Data:",S);let e=null==S?void 0:S.find(e=>e.certificateCategory===t);console.log("Selected Category Data:",e),(null==e?void 0:null===(r=e.rows)||void 0===r?void 0:r.length)?d(e.rows):d([{titleName:"",subtitleName:"",result:"",theoretical:""}])}},_=e=>{x({...e}),d(e.rows),T(e.id),v(!0)},M=async e=>{if(e.preventDefault(),D(!0),console.log("rows",c),!u.materialCode||!u.mfgDate||!u.certificateTitle){i.oR.error("Material Code, Manufacturing Date, and Certificate Title are required!"),D(!1);return}for(let e of c){let t=e.theoretical.match(/(\d+)-(\d+)/);if(t){let r=parseInt(t[1],10),a=parseInt(t[2],10),l=e.result.match(/(\d+)-(\d+)/);if(l){let e=parseInt(l[1],10),t=parseInt(l[2],10);if(isNaN(e)||isNaN(t)){i.oR.error("Result must be a valid range with numbers!"),D(!1);return}if(e<r||t>a){i.oR.error("Result must be between ".concat(r," and ").concat(a)),console.log("error","Result must be between ".concat(r," and ").concat(a)),D(!1);return}}else{let t=parseInt(e.result.replace(/\D/g,""),10);if(isNaN(t)){i.oR.error("Result must be a valid number!"),D(!1);return}if(t<r||t>a){i.oR.error("Result must be between ".concat(r," and ").concat(a)),console.log("error","Result must be between ".concat(r," and ").concat(a)),D(!1);return}}}}let r=new Date(u.mfgDate);if(isNaN(r)){i.oR.error("Invalid manufacturing date!"),D(!1);return}let a=String(r.getDate()).padStart(2,"0"),l=String(r.getMonth()+1).padStart(2,"0"),s=r.getFullYear(),n="".concat(u.materialCode).concat(a).concat(l).concat(s.toString().slice(-2));console.log("Generated Lot No:",n);let d={...u,lotno:n};console.log("Updated certificate data:",d);let x="None"!==u.certificateCategory?u.certificateCategory:u.customCategory||"";if("None"===u.certificateCategory&&!u.customCategory){i.oR.error("Please enter a custom category!"),D(!1);return}let m={...d,certificateCategory:x,customCategory:"",rows:c,employeename:null==t?void 0:t.name,employemobile:null==t?void 0:t.mobile,employeeid:null==t?void 0:t.uid,Verified:"False"};try{let e=o.I.firestore();E?(await e.collection("certificate").doc(E).update(m),i.oR.success("Certificate updated successfully!")):(await e.collection("certificate").add(m),i.oR.success("Certificate created successfully!")),v(!1),P()}catch(e){console.error("Error submitting certificate: ",e),i.oR.error("There was an error submitting the certificate.")}finally{D(!1)}},P=async()=>{let e=o.I.firestore();try{let r=(await e.collection("certificate").where("employeeid","==",null==t?void 0:t.uid).get()).docs.map(e=>({id:e.id,...e.data()}));R(r)}catch(e){console.error("Error fetching data: ",e),i.oR.error("There was an error fetching the data.")}};(0,l.useEffect)(()=>{P()},[]);let A=e=>{let{name:t,value:r}=e.target;"name"===t?p(r):"mobile"===t&&b(r)},V=async e=>{e.preventDefault(),D(!0);try{let e=o.I.firestore(),r=await e.collection("users").where("email","==",null==t?void 0:t.email).get();if(r.empty)i.oR.error("User not found!");else{let t=r.docs[0];await e.collection("users").doc(t.id).update({name:m,mobile:h}),i.oR.success("Profile updated successfully!"),C(!1)}}catch(e){console.error("Error updating profile: ",e),i.oR.error("There was an error updating the profile.")}finally{D(!1)}};return r?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("div",{className:"spinner-border animate-spin inline-block w-16 h-16 border-4 rounded-full border-t-blue-500 border-gray-200"})}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"w-full bg-gradient-to-r from-blue-50 to-blue-100 p-8 rounded-xl shadow-xl",children:[(0,a.jsxs)("h1",{className:"md:text-4xl text-xl font-semibold text-center text-blue-600 mb-6",children:["Welcome, ",null==t?void 0:t.name]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 ease-in-out",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:"Name:"}),(0,a.jsx)("span",{className:"text-gray-900",children:null==t?void 0:t.name})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 ease-in-out",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:"Email:"}),(0,a.jsx)("span",{className:"text-gray-900",children:null==t?void 0:t.email})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 ease-in-out",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:"Mobile Number:"}),(0,a.jsx)("span",{className:"text-gray-900",children:null==t?void 0:t.mobile})]}),(0,a.jsxs)("button",{onClick:()=>{C(!0)},className:"text-blue-500 flex gap-4 font-bold hover:text-blue-700",children:[(0,a.jsx)(s.SG1,{className:"mt-1"})," Edit Profile"]})]})]}),(0,a.jsxs)("div",{className:"min-h-screen bg-white flex  px-4",children:[(0,a.jsx)("button",{onClick:()=>v(e=>!e),className:"fixed bottom-20 right-4 ".concat(j?"bg-red-600":"bg-teal-600"," text-white py-3 px-6 rounded-full shadow-lg hover:opacity-90 focus:outline-none transition duration-200"),children:j?"Close":"Create Certificate"}),(0,a.jsxs)("div",{className:"w-full  bg-white rounded-lg shadow-lg p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-center text-teal-600 mb-6",children:"Certificate Data"}),(0,a.jsx)(i.N9,{}),S&&S.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full table-auto border-collapse bg-white",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Certificate Title"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Material Code"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Expiry Date"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Lot Number"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Verification Status"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-sm font-bold text-gray-700 border-b",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:S.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-teal-50",children:[(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:[t+1,".",e.certificateTitle]}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:e.materialCode}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:e.expiryDate}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:e.lotno}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:"True"===e.Verified?(0,a.jsx)("span",{className:"text-green-600 font-semibold",children:"Verified"}):(0,a.jsx)("span",{className:"text-red-600 font-semibold",children:"Pending"})}),(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-600 border-b uppercase",children:[(0,a.jsx)("button",{onClick:()=>{g(e),N(!0)},className:"text-teal-600 uppercase hover:text-teal-800",children:"View PDF"}),"False"===e.Verified?(0,a.jsx)("button",{onClick:()=>_(e),className:"text-teal-600 ml-4 uppercase hover:text-teal-800",children:"Edit"}):null]})]},t))})]})}):(0,a.jsx)("p",{className:"text-center text-gray-600",children:"No certificate data found."})]}),j&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-md shadow-lg w-full h-full p-8 overflow-y-auto",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{v(!1),x({certificateCategory:"None",certificateTitle:"",materialCode:"",lotno:"",mfgDate:"",expiryDate:"",customCategory:""}),d([{titleName:"",subtitleName:"",result:"",theoretical:""}])},className:"absolute top-4 right-4 font-bold text-red-600 hover:text-red-800",children:(0,a.jsx)(s.yGN,{size:32})}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-teal-800 mb-6 text-center",children:"Add Certificate Details"}),(0,a.jsxs)("form",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"relative z-0 w-full group",children:[(0,a.jsxs)("select",{id:"certificateCategory",className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",value:u.certificateCategory||"None",onChange:e=>F("certificateCategory",e.target.value),children:[(0,a.jsx)("option",{value:"None",children:"None"}),[...new Set(null==S?void 0:S.map(e=>e.certificateCategory))].map((e,t)=>(0,a.jsx)("option",{value:e,children:e},t))]}),(0,a.jsx)("label",{htmlFor:"certificateCategory",className:"absolute text-sm text-gray-500 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] left-0 peer-focus:left-0 peer-focus:text-teal-600 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:translate-y-[-20px] peer-focus:scale-75 transition-all duration-200",children:"Certificate Category"}),"None"===u.certificateCategory&&(0,a.jsx)("input",{type:"text",id:"customCategory",className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",placeholder:"Enter custom category",value:u.customCategory||"",onChange:e=>F("customCategory",e.target.value)})]}),(0,a.jsxs)("div",{className:"relative z-0 w-full group",children:[(0,a.jsx)("input",{type:"text",id:"certificateTitle",className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",placeholder:" ",value:u.certificateTitle,onChange:e=>F("certificateTitle",e.target.value)}),(0,a.jsx)("label",{htmlFor:"certificateTitle",className:"absolute text-sm text-gray-500 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] left-0 peer-focus:left-0 peer-focus:text-teal-600 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:translate-y-[-20px] peer-focus:scale-75 transition-all duration-200",children:"Certificate Title"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:(0,a.jsxs)("div",{className:"relative z-0 w-full group",children:[(0,a.jsx)("input",{type:"text",id:"materialCode",className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",placeholder:" ",value:u.materialCode,onChange:e=>F("materialCode",e.target.value)}),(0,a.jsx)("label",{htmlFor:"materialCode",className:"absolute text-sm text-gray-500 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] left-0 peer-focus:left-0 peer-focus:text-teal-600 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:translate-y-[-20px] peer-focus:scale-75 transition-all duration-200",children:"Material Code"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"relative z-0 w-full group",children:[(0,a.jsx)("input",{type:"date",id:"mfgDate",value:u.mfgDate,onChange:e=>F("mfgDate",e.target.value),className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",placeholder:" "}),(0,a.jsx)("label",{htmlFor:"mfgDate",className:"absolute text-sm text-gray-500 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] left-0 peer-focus:left-0 peer-focus:text-teal-600 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:translate-y-[-20px] peer-focus:scale-75 transition-all duration-200",children:"Manufacturing Date"})]}),(0,a.jsxs)("div",{className:"relative z-0 w-full group",children:[(0,a.jsx)("input",{type:"date",id:"expiryDate",value:u.expiryDate,onChange:e=>F("expiryDate",e.target.value),className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer",placeholder:" "}),(0,a.jsx)("label",{htmlFor:"expiryDate",className:"absolute text-sm text-gray-500 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] left-0 peer-focus:left-0 peer-focus:text-teal-600 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:translate-y-[-20px] peer-focus:scale-75 transition-all duration-200",children:"Expiry Date"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto mb-6",children:(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-teal-50",children:[(0,a.jsx)("th",{className:"border text-center border-gray-300 px-4 py-2 text-teal-800",children:"Pre-plated Medium/20 dishes"}),(0,a.jsx)("th",{className:"border text-center border-gray-300 px-4 py-2 text-teal-800",children:"Result"}),(0,a.jsx)("th",{className:"border text-center border-gray-300 px-4 py-2 text-teal-800",children:"Theoretical Results"}),(0,a.jsx)("th",{className:"border text-center border-gray-300 px-4 py-2 text-teal-800",children:"Action"})]})}),(0,a.jsx)("tbody",{children:c.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"border border-gray-300 px-4 py-2",children:[(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)("input",{type:"text",placeholder:"Enter Title Name",className:"block py-2 px-3 w-full text-sm text-gray-900 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500",value:e.titleName,onChange:e=>I(t,"titleName",e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Enter Subtitle Name",className:"block py-2 px-3 w-full text-sm text-gray-900 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500",value:e.subtitleName,onChange:e=>I(t,"subtitleName",e.target.value)})})]}),(0,a.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:(0,a.jsx)("input",{type:"text",placeholder:"Enter Results",className:"block py-2 px-3 w-full text-sm text-gray-900 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500",value:e.result,onChange:e=>I(t,"result",e.target.value)})}),(0,a.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:(0,a.jsx)("input",{type:"text",placeholder:"Enter Theoretical Results",className:"block py-2 px-3 w-full text-sm text-gray-900 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500",value:e.theoretical,onChange:e=>I(t,"theoretical",e.target.value)})}),(0,a.jsx)("td",{className:"border border-gray-300 px-4 py-2 text-center",children:(0,a.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>z(t),children:(0,a.jsx)(s.IXo,{size:20})})})]},t))})]})}),(0,a.jsx)("button",{type:"button",className:"w-full mb-6 py-2 px-4 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition duration-300",onClick:()=>{d([...c,{titleName:"",subtitleName:"",result:"",theoretical:""}])},children:"Add Row"}),(0,a.jsx)("button",{onClick:M,disabled:k,className:"py-2 px-4 rounded-md transition ".concat(k?"bg-gray-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-800 text-white"),children:E?"Update":"Submit"})]})]})}),y&&f&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full h-[100vh] overflow-y-auto relative",children:[(0,a.jsx)("button",{onClick:()=>N(!1),className:"absolute top-4  right-4 text-red-500 font-bold hover:text-red-700",children:(0,a.jsx)(s.yGN,{size:32})}),(0,a.jsx)(n.A,{data:f})]})}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-center mb-4",children:"Edit Profile"}),(0,a.jsxs)("form",{onSubmit:V,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-gray-700",children:"Name"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:m,onChange:A,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"mobile",className:"block text-gray-700",children:"Mobile Number"}),(0,a.jsx)("input",{type:"text",id:"mobile",name:"mobile",value:h,onChange:A,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{C(!1)},className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:k,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:k?"Updating...":"Update"})]})]})]})}),(0,a.jsx)(i.N9,{})]})]})};var d=r(7037),u=r(6715);let x=()=>{let[e,t]=(0,l.useState)("home"),[r,s]=(0,l.useState)(null),[i,n]=(0,l.useState)(!0),x=(0,u.useRouter)();(0,l.useEffect)(()=>{let e=o.I.auth().onAuthStateChanged(async e=>{if(e)try{let t=o.I.firestore().collection("users").doc(e.uid),r=await t.get();r.exists?s(r.data()):console.log("No such user!")}catch(e){console.error("Error fetching user data:",e)}finally{n(!1)}else n(!1),x.push("/")});return()=>e()},[x]);let m=async()=>{try{await o.I.auth().signOut(),x.push("/")}catch(e){console.error("Logout failed:",e)}};return i?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("div",{className:"spinner-border animate-spin inline-block w-16 h-16 border-4 rounded-full border-t-blue-500 border-gray-200"})}):(0,a.jsxs)("div",{className:"flex flex-col h-screen justify-between",children:[(0,a.jsx)("div",{children:"home"===e&&(0,a.jsx)(c,{userData:r,loading:i})}),(0,a.jsxs)("div",{className:"fixed bottom-0 left-0 w-full bg-white shadow-lg border-t flex justify-around py-3",children:[(0,a.jsxs)("button",{className:"flex flex-col items-center text-sm ".concat("home"===e?"text-blue-500":"text-gray-600"),onClick:()=>t("home"),children:[(0,a.jsx)(d.rQ8,{size:24}),"Home"]}),(0,a.jsxs)("button",{className:"flex flex-col items-center text-sm text-red-500",onClick:m,children:[(0,a.jsx)(d.axc,{size:24}),"Logout"]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[883,951,563,864,673,465,301,93,264,841,636,593,792],()=>t(8971)),_N_E=e.O()}]);